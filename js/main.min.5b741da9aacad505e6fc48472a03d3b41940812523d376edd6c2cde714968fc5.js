const closeNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.add("hidden"),t&&t.setAttribute("aria-expanded","false")},openNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.remove("hidden"),t&&t.setAttribute("aria-expanded","true")},handleThemeToggle=()=>{const e=document.documentElement,n=e.getAttribute("data-theme"),t=n==="dark"?"light":"dark";e.setAttribute("data-theme",t),localStorage.setItem("theme",t),updateBadgeThemes()},updateBadgeThemes=()=>{const e=document.documentElement.getAttribute("data-theme");document.querySelectorAll(".themed-badge").forEach(t=>{const n=t.getAttribute("data-light-src"),s=t.getAttribute("data-dark-src");e==="dark"?t.src=s:t.src=n})},handleScroll=()=>{const e=document.querySelector("#progress"),t=window.scrollY,n=document.documentElement.scrollHeight-document.documentElement.clientHeight;e&&e.style.setProperty("--scroll",`${t/n*100}%`)},handleCodeFolding=()=>{document.querySelectorAll(".highlight").forEach(e=>{const t=e.querySelector("pre");if(t&&t.scrollHeight>200){t.style.maxHeight="200px";const n=document.createElement("div");n.className="code-toggle",n.innerHTML='<span class="code-toggle-text">展开</span><i class="iconfont icon-arrow-down"></i>',n.onclick=()=>{const e=t.style.maxHeight!=="200px";t.style.maxHeight=e?"200px":"none",n.querySelector(".code-toggle-text").textContent=e?"展开":"收起"},e.insertBefore(n,t)}})},renderPoemFallback=e=>{const t=e.querySelector(".poem-sentence"),n=e.querySelector(".poem-info");if(!t||!n)return;t.textContent="今日诗词加载失败",n.textContent=""},renderPoem=(e,t)=>{const n=e.querySelector(".poem-sentence"),s=e.querySelector(".poem-info");if(!n||!s)return;if(!t||!t.data||!t.data.origin){renderPoemFallback(e);return}n.textContent=t.data.content,s.textContent="【"+t.data.origin.dynasty+"】"+t.data.origin.author+"《"+t.data.origin.title+"》"},loadPoemForCard=e=>{if(!window.jinrishici||!window.jinrishici.load)return;window.jinrishici.load(t=>{try{renderPoem(e,t)}catch{renderPoemFallback(e)}})},loadPoemSdkOnce=()=>{if(window.jinrishici?.load){document.dispatchEvent(new Event("jinrishici:ready"));return}if(window.__jinrishici_script_loading)return;window.__jinrishici_script_loading=!0;const e=document.createElement("script");e.src="https://sdk.jinrishici.com/v2/browser/jinrishici.js",e.charset="utf-8",e.defer=!0,e.onload=()=>{document.dispatchEvent(new Event("jinrishici:ready"))},e.onerror=()=>{document.dispatchEvent(new Event("jinrishici:error"))},document.head.appendChild(e)},initPoemCards=()=>{const t=document.querySelectorAll(".poem-card");if(!t.length)return;const e=[];if(t.forEach(t=>{if(t.dataset.jinrishiciInit==="1")return;t.dataset.jinrishiciInit="1",e.push(t)}),!e.length)return;const n=()=>{e.forEach(e=>{loadPoemForCard(e)})},s=()=>{e.forEach(e=>{renderPoemFallback(e)})};document.addEventListener("jinrishici:ready",n,{once:!0}),document.addEventListener("jinrishici:error",s,{once:!0}),loadPoemSdkOnce()};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{if(e.target.closest("#nav-toggle")){const e=document.getElementById("nav-content");e?.classList.contains("hidden")?openNav():closeNav()}else e.target.closest("#nav-content a")&&closeNav();e.target.closest("#switchTheme")&&handleThemeToggle()});const e=window.matchMedia("(prefers-color-scheme: dark)");e.addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),updateBadgeThemes()}}),document.addEventListener("scroll",handleScroll),updateBadgeThemes(),setTimeout(()=>{document.documentElement.style.removeProperty("transition")},0),handleCodeFolding(),initPoemCards()})