const closeNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.add("hidden"),t&&t.setAttribute("aria-expanded","false")},openNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.remove("hidden"),t&&t.setAttribute("aria-expanded","true")},handleThemeToggle=()=>{const e=document.documentElement,t="dark"===e.getAttribute("data-theme")?"light":"dark";e.setAttribute("data-theme",t),localStorage.setItem("theme",t),updateBadgeThemes()},updateBadgeThemes=()=>{const e=document.documentElement.getAttribute("data-theme");document.querySelectorAll(".themed-badge").forEach(t=>{const n=t.getAttribute("data-light-src"),o=t.getAttribute("data-dark-src");t.src="dark"===e?o:n})},handleScroll=()=>{const e=document.querySelector("#progress"),t=window.scrollY,n=document.documentElement.scrollHeight-document.documentElement.clientHeight;e&&e.style.setProperty("--scroll",t/n*100+"%")},handleCodeFolding=()=>{document.querySelectorAll(".highlight").forEach((e,t)=>{const n=e.querySelector("pre");if(n&&n.scrollHeight>200){n.style.maxHeight="200px";const o=`code-block-${t}`;n.id=o;const i=document.createElement("div");i.className="code-toggle",i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",o),i.setAttribute("aria-label","展开代码块"),i.innerHTML='<span class="code-toggle-text">展开</span><i class="iconfont icon-arrow-down"></i>';const r=()=>{const e="200px"!==n.style.maxHeight;n.style.maxHeight=e?"200px":"none",i.setAttribute("aria-expanded",!e),i.setAttribute("aria-label",e?"展开代码块":"收起代码块"),i.querySelector(".code-toggle-text").textContent=e?"展开":"收起"};i.onclick=r,i.onkeydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())},e.insertBefore(i,n)}})},renderPoemFallback=e=>{const t=e.querySelector(".poem-sentence"),n=e.querySelector(".poem-info");t&&n&&(t.textContent="今日诗词加载失败",n.textContent="")},renderPoem=(e,t)=>{const n=e.querySelector(".poem-sentence"),o=e.querySelector(".poem-info");n&&o&&(t&&t.data&&t.data.origin?(n.textContent=t.data.content,o.textContent="【"+t.data.origin.dynasty+"】"+t.data.origin.author+"《"+t.data.origin.title+"》"):renderPoemFallback(e))},loadPoemForCard=e=>{window.jinrishici&&window.jinrishici.load&&window.jinrishici.load(t=>{try{renderPoem(e,t)}catch(t){renderPoemFallback(e)}})},loadPoemSdkOnce=()=>{if(window.jinrishici?.load)return void document.dispatchEvent(new Event("jinrishici:ready"));if(window.__jinrishici_script_loading)return;window.__jinrishici_script_loading=!0;const e=document.createElement("script");e.src="https://sdk.jinrishici.com/v2/browser/jinrishici.js",e.charset="utf-8",e.defer=!0,e.onload=()=>{document.dispatchEvent(new Event("jinrishici:ready"))},e.onerror=()=>{document.dispatchEvent(new Event("jinrishici:error"))},document.head.appendChild(e)},initPoemCards=()=>{const e=document.querySelectorAll(".poem-card");if(!e.length)return;const t=[];if(e.forEach(e=>{"1"!==e.dataset.jinrishiciInit&&(e.dataset.jinrishiciInit="1",t.push(e))}),!t.length)return;document.addEventListener("jinrishici:ready",()=>{t.forEach(e=>{loadPoemForCard(e)})},{once:!0}),document.addEventListener("jinrishici:error",()=>{t.forEach(e=>{renderPoemFallback(e)})},{once:!0}),loadPoemSdkOnce()};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{if(e.target.closest("#nav-toggle")){const e=document.getElementById("nav-content");e?.classList.contains("hidden")?openNav():closeNav()}else e.target.closest("#nav-content a")&&closeNav();e.target.closest("#switchTheme")&&handleThemeToggle()});window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),updateBadgeThemes()}}),document.addEventListener("scroll",handleScroll),updateBadgeThemes(),setTimeout(()=>{document.documentElement.style.removeProperty("transition")},0),handleCodeFolding(),initPoemCards()});