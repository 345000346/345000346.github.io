const closeNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.add("hidden"),t&&t.setAttribute("aria-expanded","false")},openNav=()=>{const e=document.getElementById("nav-content"),t=document.getElementById("nav-toggle");e&&e.classList.remove("hidden"),t&&t.setAttribute("aria-expanded","true")},applyThemeIcons=e=>{const t=document.getElementById("light-icon"),n=document.getElementById("dark-icon");t&&n&&(e?(t.classList.add("hidden"),n.classList.remove("hidden")):(t.classList.remove("hidden"),n.classList.add("hidden")))},initTheme=()=>{const e=document.documentElement,t="dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;t?(e.classList.add("dark"),localStorage.theme="dark"):(e.classList.remove("dark"),localStorage.theme="light"),applyThemeIcons(t),updateBadgeThemes(t)},handleThemeToggle=()=>{const e=document.documentElement,t=!e.classList.contains("dark");t?(e.classList.add("dark"),localStorage.theme="dark"):(e.classList.remove("dark"),localStorage.theme="light"),applyThemeIcons(t),updateBadgeThemes(t)},updateBadgeThemes=(e=document.documentElement.classList.contains("dark"))=>{document.querySelectorAll(".themed-badge").forEach(t=>{const n=t.getAttribute("data-light-src"),o=t.getAttribute("data-dark-src");t.src=e?o:n})},handleScroll=()=>{const e=document.querySelector("#progress"),t=document.getElementById("nav-content"),n=window.scrollY,o=document.documentElement.scrollHeight-document.documentElement.clientHeight;e&&o>0&&e.style.setProperty("--scroll",n/o*100+"%"),t&&(n>10?t.classList.remove("bg-gray-100"):t.classList.add("bg-gray-100"))},handleCodeFolding=()=>{document.querySelectorAll(".highlight").forEach((e,t)=>{const n=e.querySelector("pre");if(n&&n.scrollHeight>200){n.style.maxHeight="200px";const o=`code-block-${t}`;n.id=o;const a=document.createElement("div");a.className="code-toggle",a.setAttribute("role","button"),a.setAttribute("tabindex","0"),a.setAttribute("aria-expanded","false"),a.setAttribute("aria-controls",o),a.setAttribute("aria-label","展开代码块"),a.innerHTML='<span class="code-toggle-text">展开</span><i class="iconfont icon-arrow-down"></i>';const d=()=>{const e="200px"!==n.style.maxHeight;n.style.maxHeight=e?"200px":"none",a.setAttribute("aria-expanded",!e),a.setAttribute("aria-label",e?"展开代码块":"收起代码块"),a.querySelector(".code-toggle-text").textContent=e?"展开":"收起"};a.onclick=d,a.onkeydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),d())},e.insertBefore(a,n)}})},renderPoemFallback=e=>{const t=e.querySelector(".poem-sentence"),n=e.querySelector(".poem-info");t&&n&&(t.textContent="今日诗词加载失败",n.textContent="")},renderPoem=(e,t)=>{const n=e.querySelector(".poem-sentence"),o=e.querySelector(".poem-info");n&&o&&(t&&t.data&&t.data.origin?(n.textContent=t.data.content,o.textContent="【"+t.data.origin.dynasty+"】"+t.data.origin.author+"《"+t.data.origin.title+"》"):renderPoemFallback(e))},loadPoemForCard=e=>{window.jinrishici&&window.jinrishici.load&&window.jinrishici.load(t=>{try{renderPoem(e,t)}catch(t){renderPoemFallback(e)}})},loadPoemSdkOnce=()=>{if(window.jinrishici?.load)return void document.dispatchEvent(new Event("jinrishici:ready"));if(window.__jinrishici_script_loading)return;window.__jinrishici_script_loading=!0;const e=document.createElement("script");e.src="https://sdk.jinrishici.com/v2/browser/jinrishici.js",e.charset="utf-8",e.defer=!0,e.onload=()=>{document.dispatchEvent(new Event("jinrishici:ready"))},e.onerror=()=>{document.dispatchEvent(new Event("jinrishici:error"))},document.head.appendChild(e)},initPoemCards=()=>{const e=document.querySelectorAll(".poem-card");if(!e.length)return;const t=[];if(e.forEach(e=>{"1"!==e.dataset.jinrishiciInit&&(e.dataset.jinrishiciInit="1",t.push(e))}),!t.length)return;document.addEventListener("jinrishici:ready",()=>{t.forEach(e=>{loadPoemForCard(e)})},{once:!0}),document.addEventListener("jinrishici:error",()=>{t.forEach(e=>{renderPoemFallback(e)})},{once:!0}),loadPoemSdkOnce()};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{if(e.target.closest("#nav-toggle")){const e=document.getElementById("nav-content");e?.classList.contains("hidden")?openNav():closeNav()}else e.target.closest("#nav-content a")&&closeNav();e.target.closest("#switchTheme")&&handleThemeToggle()});window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches;t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),applyThemeIcons(t),updateBadgeThemes(t)}}),document.addEventListener("scroll",handleScroll),initTheme(),setTimeout(()=>{document.documentElement.style.removeProperty("transition")},0),handleCodeFolding(),initPoemCards(),handleScroll()});