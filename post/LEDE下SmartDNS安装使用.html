<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>LEDE下SmartDNS安装使用 | LIGT&#39;S</title>
    <meta property="og:title" content="LEDE下SmartDNS安装使用 - LIGT&#39;S">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2019-12-10T19:32:10&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2019-12-10T19:32:10&#43;08:00'>
        
    <meta name="Keywords" content="日常,想法,Android,Windows,手机,电脑">
    <meta name="description" content="LEDE下SmartDNS安装使用">
        
    <meta name="author" content="LIGT">
    <meta property="og:url" content="https://owovo.xyz/post/LEDE%E4%B8%8BSmartDNS%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8.html">
    <link rel="shortcut icon" href='/favicon.ico/'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    
    
    
    <link rel="stylesheet" href='/css/style-dark.css'>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                <a id="logo" href="https://owovo.xyz">
                    LIGT&#39;S
                </a>
                
                <p class="description">分享一些日常、没事无聊的瞎想、一些常用的工具等</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://owovo.xyz">首页</a>
                    
                    <a  href="https://owovo.xyz/archives.html" title="文章">文章</a>
                    
                    <a  href="https://owovo.xyz/categories.html" title="分类">分类</a>
                    
                    <a  href="https://owovo.xyz/tags.html" title="标签">标签</a>
                    
                    <a  href="https://owovo.xyz/ideas.html" title="想法">想法</a>
                    
                    <a  href="https://owovo.xyz/about.html" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>
    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<script src="/js/addaTartget.js"></script>
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">LEDE下SmartDNS安装使用</h1>
        </header>
        <date class="post-meta meta-date">
            2019年12月10日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/%E8%B7%AF%E7%94%B1%E5%99%A8'>路由器</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content" id="post-content-id">
            <p>SmartDNS 是一个运行在本地的 DNS 服务器，SmartDNS 接受本地客户端的 DNS 查询请求，从多个上游 DNS 服务器获取 DNS 查询结果，并将访问速度最快的结果返回给客户端，提高网络访问速度。 同时支持指定特定域名 IP 地址，并高性匹配，达到过滤广告的效果。
与 dnsmasq 的 all-servers 不同，smartdns 返回的是访问速度最快的解析结果。</p>
<!-- raw HTML omitted -->
<h2 id="1--安装">1.  安装</h2>
<p>将软件使用 winscp 上传到路由器的 /root 目录，执行如下命令安装</p>
<pre><code> opkg install smartdns.xxxxxxxx.xxxx.ipk
 opkg install luci-app-smartdns.xxxxxxxx.xxxx.all.ipk
</code></pre><h2 id="2-修改配置">2. 修改配置</h2>
<p>登录 openwrt 管理页面，打开 <code>Services</code>-&gt;<code>SmartDNS</code> 进行配置。</p>
<ul>
<li>在 <code>Upstream Servers</code> 增加上游 DNS 服务器配置，建议配置多个国内外 DNS 服务器。</li>
<li>在 <code>Domain Address</code> 指定特定域名的 IP 地址，可用于广告屏蔽。</li>
</ul>
<h2 id="3-启用服务">3. 启用服务</h2>
<p>SmartDNS 中重定向选中<code>重定向53端口到SmartDNS</code>。</p>
<ul>
<li>
<p><strong>启用 smartdns 的 53 端口重定向</strong></p>
<p>登录路由器，点击 <code>Services</code>-&gt;<code>SmartDNS</code>-&gt;<code>redirect</code>，选择<code>重定向53端口到SmartDNS</code> 启用 53 端口转发。</p>
</li>
<li>
<p><strong>检测转发服务是否配置成功</strong></p>
<p>使用 <code>nslookup -querytype=ptr 0.0.0.0</code> 查询域名
看命令结果中的 <code>name</code> 项目是否显示为 <code>smartdns</code> 或<code>主机名</code>，如 <code>smartdns</code> 则表示生效</p>
<pre><code>  pi@raspberrypi:~/code/smartdns_build $ nslookup -querytype=ptr 0.0.0.0
  Server:         192.168.1.1
  Address:        192.168.1.1##53
     
  Non-authoritative answer:
  0.0.0.0.in-addr.arpa  name = smartdns.
</code></pre></li>
<li>
<p><strong>界面提示重定向失败</strong></p>
<ul>
<li>检查 iptable，ip6table 命令是否正确安装。</li>
<li>openwrt 15.01 系统不支持 IPV6 重定向，如网络需要支持 IPV6，请将 DNSMASQ 上游改为 smartdns，或者将 smartdns 的端口改为 53，并停用 dnsmasq。</li>
<li>LEDE 之后系统，请安装 IPV6 的 nat 转发驱动。点击 <code>system</code>-&gt;<code>Software</code>，点击 <code>update lists</code> 更新软件列表后，安装 <code>ip6tables-mod-nat</code></li>
<li>使用如下命令检查路由规则是否生效。</li>
</ul>
<pre><code>  iptables -t nat -L PREROUTING | grep REDIRECT
</code></pre></li>
</ul>
<h2 id="4-启动服务">4. 启动服务</h2>
<p>勾选配置页面中的 <code>Enable(启用)</code> 来启动 SmartDNS</p>
<h2 id="5-注意">5. 注意：</h2>
<ul>
<li>如已经安装 chinaDNS，建议将 chinaDNS 的上游配置为 SmartDNS。</li>
<li>SmartDNS 默认情况，将 53 端口的请求转发到 SmartDNS 的本地端口，由 <code>Redirect</code> 配置选项控制。</li>
</ul>

        </div>

        
        <script type="text/javascript">
            addaTarget("post-content-id");
        </script>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/%E5%B0%86ProxmoxVE5.4%E5%8D%87%E7%BA%A7%E5%88%B0ProxmoxVE6.html">将 Proxmox VE 5.4 升级到 Proxmox VE 6（使用国内源）</a></li>
        
        <li><a href="/post/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Windows10%E7%B3%BB%E7%BB%9F.html">如何安装Windows10系统</a></li>
        
        <li><a href="/post/Windows-Apps.html">Windows 常用软件</a></li>
        
        <li><a href="/post/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%88%86%E6%89%8B%E5%90%8E%E6%9C%89%E4%BA%9B%E4%BA%BA%E8%BF%98%E8%83%BD%E5%83%8F%E6%B2%A1%E4%BA%8B%E4%BA%BA%E4%B8%80%E6%A0%B7.html">为什么分手后有些人还能像没事人一样？</a></li>
        
        <li><a href="/post/%E6%89%B9%E9%87%8F%E5%8E%BB%E9%99%A4%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%AD%E7%9A%84%E7%A9%BA%E6%A0%BC%E6%89%B9%E9%87%8F%E9%87%8D%E5%91%BD%E5%90%8D.html">批量去除文件名中的空格、批量重命名</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E8%B7%AF%E7%94%B1%E5%99%A8'>路由器</a></li>
                
                <li><a href='/tags/DNS'>DNS</a></li>
                
                <li><a href='/tags/%E5%B7%A5%E5%85%B7'>工具</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                </div>

                <div id="secondary">
    
    <section class="widget">
        <h3 class="widget-title">今日诗词</h3>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<div id="poem_sentence" style="color: #B8B8B8;"></div>
<br>
<div id="poem_info" style="color: #B8B8B8;"></div>
<script type="text/javascript">
  jinrishici.load(function(result) {
    var sentence = document.querySelector("#poem_sentence")
    var info = document.querySelector("#poem_info")
    sentence.innerHTML = result.data.content
    info.innerHTML = '【' + result.data.origin.dynasty + '】' + result.data.origin.author + '《' + result.data.origin.title + '》'
  });
</script>
    </section>
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://owovo.xyz/post/%E6%88%91%E8%BF%99%E4%B8%AA%E6%80%A7%E6%A0%BC%E7%A1%AE%E5%AE%9E%E8%AF%A5%E6%94%B9%E6%94%B9%E4%BA%86....html" title="我这个性格，确实该改改了...">我这个性格，确实该改改了...</a>
    </li>
    
    <li>
        <a href="https://owovo.xyz/post/%E8%BD%AC%E8%BD%BD%E5%93%AA%E4%B8%AA%E7%9E%AC%E9%97%B4%E8%AE%A9%E4%BD%A0%E7%9F%A5%E9%81%93%E8%87%AA%E5%B7%B1%E5%B7%B2%E7%BB%8F%E4%B8%8D%E5%B0%8F%E4%BA%86-%E9%87%8E%E8%89%AF%E7%A5%9E%E7%9A%84%E5%9B%9E%E7%AD%94-%E7%9F%A5%E4%B9%8E.html" title="（转载）哪个瞬间让你知道自己已经不小了? - 野良神的回答 - 知乎">（转载）哪个瞬间让你知道自己已经不小了? - 野良神的回答 - 知乎</a>
    </li>
    
    <li>
        <a href="https://owovo.xyz/post/%E5%B0%8F%E7%B1%B310-Pro%E7%AE%80%E5%8D%95%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C.html" title="小米10 Pro简单上手体验">小米10 Pro简单上手体验</a>
    </li>
    
    <li>
        <a href="https://owovo.xyz/post/%E4%BD%BF%E7%94%A8GithubActions&#43;Hugo&#43;GithubPages%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2.html" title="使用 Github Actions &#43; Hugo &#43; Github Pages搭建博客">使用 Github Actions &#43; Hugo &#43; Github Pages搭建博客</a>
    </li>
    
    <li>
        <a href="https://owovo.xyz/post/Flash%E5%8E%BB%E5%8C%BA%E5%9F%9F%E9%99%90%E5%88%B6.html" title="Flash去区域限制">Flash去区域限制</a>
    </li>
    
</ul>
<a href="/post.html" style="color: #0789E0">查看更多</a>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="https://owovo.xyz/categories/API.html">API (1)</a></li>
    
    <li><a href="https://owovo.xyz/categories/Hugo.html">Hugo (3)</a></li>
    
    <li><a href="https://owovo.xyz/categories/Windows.html">Windows (2)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E5%B7%A5%E5%85%B7.html">工具 (1)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E6%83%85%E6%84%9F.html">情感 (3)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E6%89%8B%E6%9C%BA.html">手机 (1)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E8%84%9A%E6%9C%AC.html">脚本 (2)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E8%B7%AF%E7%94%B1%E5%99%A8.html">路由器 (2)</a></li>
    
    <li><a href="https://owovo.xyz/categories/%E9%9A%8F%E6%83%B3.html">随想 (1)</a></li>
    
</ul>
    </section>
    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://owovo.xyz/tags/API.html">API</a>
    
    <a href="https://owovo.xyz/tags/DNS.html">DNS</a>
    
    <a href="https://owovo.xyz/tags/Github.html">Github</a>
    
    <a href="https://owovo.xyz/tags/Hugo.html">Hugo</a>
    
    <a href="https://owovo.xyz/tags/Proxmox.html">Proxmox</a>
    
    <a href="https://owovo.xyz/tags/V2ex.html">V2ex</a>
    
    <a href="https://owovo.xyz/tags/Windows.html">Windows</a>
    
    <a href="https://owovo.xyz/tags/%E4%BB%8A%E6%97%A5%E8%AF%97%E8%AF%8D.html">今日诗词</a>
    
    <a href="https://owovo.xyz/tags/%E5%B0%8F%E7%B1%B3.html">小米</a>
    
    <a href="https://owovo.xyz/tags/%E5%B7%A5%E5%85%B7.html">工具</a>
    
    <a href="https://owovo.xyz/tags/%E6%83%85%E6%84%9F.html">情感</a>
    
    <a href="https://owovo.xyz/tags/%E6%89%8B%E6%9C%BA.html">手机</a>
    
    <a href="https://owovo.xyz/tags/%E7%B3%BB%E7%BB%9F.html">系统</a>
    
    <a href="https://owovo.xyz/tags/%E8%84%9A%E6%9C%AC.html">脚本</a>
    
    <a href="https://owovo.xyz/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA.html">虚拟机</a>
    
    <a href="https://owovo.xyz/tags/%E8%B7%AF%E7%94%B1%E5%99%A8.html">路由器</a>
    
    <a href="https://owovo.xyz/tags/%E8%BD%AF%E4%BB%B6.html">软件</a>
    
    <a href="https://owovo.xyz/tags/%E9%9A%8F%E6%83%B3.html">随想</a>
    
</div>
    </section>
    <section class="widget">
        
<section class="widget">
    <h3 class="widget-title">我的链接</h3>
		<ul class="widget-list">
	        
	        <li>
	            <a target="_blank" href="https://weibo.com/u/1733321624"><img src="https://img.shields.io/badge/dynamic/json?style=flat-square&amp;color=E6162D&amp;labelColor=282c34&amp;label=%e5%be%ae%e5%8d%9a&amp;query=$.data.totalSubs&amp;suffix=%20%e5%85%b3%e6%b3%a8%e8%80%85&amp;url=https%3A%2F%2Fapi.spencerwoo.com%2Fsubstats%2F%3Fsource%3Dweibo%26queryKey%3D1733321624&amp;logo=sina-weibo"></a>
	        </li>
	        
	        <li>
	            <a target="_blank" href="https://github.com/345000346"><img src="https://img.shields.io/badge/dynamic/json?style=flat-square&amp;color=181717&amp;labelColor=282c34&amp;label=GitHub&amp;query=$.data.totalSubs&amp;suffix=%20%e5%85%b3%e6%b3%a8%e8%80%85&amp;url=https%3A%2F%2Fapi.spencerwoo.com%2Fsubstats%2F%3Fsource%3Dgithub%26queryKey%3D345000346&amp;logo=github"></a>
	        </li>
	        
	        <li>
	            <a target="_blank" href="https://www.zhihu.com/people/Hibernate_"><img src="https://img.shields.io/badge/dynamic/json?style=flat-square&amp;color=0084ff&amp;labelColor=282c34&amp;label=%e7%9f%a5%e4%b9%8e&amp;query=$.data.totalSubs&amp;suffix=%20%e5%85%b3%e6%b3%a8%e8%80%85&amp;url=https%3A%2F%2Fapi.spencerwoo.com%2Fsubstats%2F%3Fsource%3Dzhihu%26queryKey%3DHibernate_&amp;logo=zhihu"></a>
	        </li>
	        
	    </ul>
</section>

    </section>
    <section class="widget">
        
    </section>
    
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        
         本站已稳定运行
        <b id="d"></b> 天 <b id="h"></b> 小时 <b id="m"></b> 分 <b id="s"></b> 秒
        <script>
            function timer() {
                var start = new Date("8/22/2019 00:00:00");
            var t = new Date() - start;
            var h = ~~(t / 1000 / 60 / 60 % 24);
            if (h < 10) {
                h = "0" + h;
            }
            var m = ~~(t / 1000 / 60 % 60);
            if (m < 10) {
                m = "0" + m;
            }
            var s = ~~(t / 1000 % 60);
            if (s < 10) {
                s = "0" + s;
            }
            document.getElementById('d').innerHTML = ~~(t / 1000 / 60 / 60 / 24);
            document.getElementById('h').innerHTML = h;
            document.getElementById('m').innerHTML = m;
            document.getElementById('s').innerHTML = s;
            }
            timer();
            setInterval(timer, 1000);
        </script>
        <br> &copy; 2020 <a href="https://owovo.xyz">LIGT&#39;S</a> Designed by
        LIGT. Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io"
            target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a
            href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
         Hosted by <a rel="nofollow noreferer noopener"
            href="https://pages.github.com" target="_blank">Github Pages</a>. 
    </div>
</footer>



<script type="text/javascript">
    window.MathJax = {
        tex2jax: {
            inlineMath: [
                ['$', '$']
            ],
            processEscapes: true
        }
    };
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-47934503-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
 
<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>